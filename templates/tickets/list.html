{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="page-body">
  {% include "partials/_alerts.html" %}

  <!-- Status Widgets -->
  {% include "tickets/_widgets.html" %}

  <div class="card">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h5 class="mb-0">Tickets</h5>
      <a class="btn btn-primary" href="{% url 'tickets:new' %}">
        <i class="fa fa-plus me-1"></i> New Ticket
      </a>
    </div>

    <div class="card-body">
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th style="width: 70px;">#</th>
              <th>Title</th>
              <th style="width: 140px;">Priority</th>
              <th style="width: 160px;">Status</th>
              <th style="width: 220px;">Assignee</th>
              <th style="width: 200px;">Created</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tickets %}
              <tr>
                <td>
                  <a href="{% url 'tickets:detail' t.pk %}">#{{ t.pk }}</a>
                </td>
                <td class="fw-500">
                  <a class="text-decoration-none" href="{% url 'tickets:detail' t.pk %}">
                    {{ t.title }}
                  </a>
                </td>
                <td>
                  <span class="badge
                    {% if t.priority == 'URG' %} bg-danger
                    {% elif t.priority == 'HIGH' %} bg-warning text-dark
                    {% elif t.priority == 'MED' %} bg-primary
                    {% else %} bg-secondary{% endif %}">
                    {{ t.get_priority_display }}
                  </span>
                </td>
                <td>{{ t.get_status_display }}</td>
                <td>{{ t.assignee.first_name }} {{ t.assignee.last_name }}</td>
                <td>{{ t.created_at|date:"Y-m-d H:i" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6" class="text-center text-muted py-5">
                  No tickets yet. <a href="{% url 'tickets:new' %}">Create the first ticket</a>.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}