{% load static %}
<aside id="lcSidebar" aria-hidden="true" class="lc-sidebar">
    <div id="lcSidebarOverlay" class="d-md-none"
         style="position:fixed;inset:0;background:rgba(39,50,71,.25);display:none;z-index:1039;"></div>
    <div class="lc-sidebar-head d-flex align-items-center justify-content-between px-3" style="height:56px;">
        <a href="{% url 'router:dashboard' %}" class="navbar-brand d-flex align-items-center gap-2 text-decoration-none">
            <img class="img-fluid" src="{% static 'assets/images/logo/logo_light.png' %}" alt="Lucid" style="height:28px;">
            <span class="fw-bold">Lucid</span>
        </a>
        <button type="button" class="btn btn-sm btn-outline-secondary d-md-none" id="lcSidebarClose" aria-label="Close">
            ✕
        </button>
    </div>

    <nav class="lc-sidebar-body sidebar-main" id="sidebar-menu">
        <ul class="nav flex-column px-2">
            <li class="nav-item section-title px-2"><span class="section-pill">APPLICATIONS</span></li>

            <!-- Common -->
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2 {% if request.resolver_match.url_name == 'index' or request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'role_redirect' %}active{% endif %}"
                   href="{% url 'router:dashboard' %}">
                    <i data-feather="home" class="opacity-75"></i>
                    <span>Dashboard</span>
                </a>
            </li>

            {% if request.user.role == 'LAD' or request.user.role == 'LUS' %}
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'tenants:evaluator_detail' %}">
                        <i data-feather="users" class="opacity-75"></i>
                        <span>Evaluators</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'payments:list' %}">
                        <i data-feather="credit-card" class="opacity-75"></i>
                        <span>Payments & Transactions</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2 {% if request.resolver_match.namespace == 'tickets' %}active{% endif %}"
                       href="{% url 'tickets:list' %}">
                        <i data-feather="life-buoy" class="opacity-75"></i>
                        <span>Tickets</span>
                    </a>
                </li>
                {% if request.user.role == 'LAD' %}
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center gap-2" href="{% url 'accounts:staff' %}">
                            <i data-feather="briefcase" class="opacity-75"></i>
                            <span>Lucid Staff</span>
                        </a>
                    </li>
                {% endif %}
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'preferences:index' %}">
                        <i data-feather="settings" class="opacity-75"></i>
                        <span>Settings</span>
                    </a>
                </li>
            {% endif %}

            <li class="nav-item section-title px-2"><span class="section-pill">EVALUATOR</span></li>
            {% if request.user.role == 'EAD' or request.user.role == 'EVS' %}
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'tenants:suppliers_list' %}">
                        <i data-feather="truck" class="opacity-75"></i>
                        <span>Suppliers</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'activities:list' %}">
                        <i data-feather="folder" class="opacity-75"></i>
                        <span>Activities</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2 {% if request.resolver_match.namespace == 'tickets' %}active{% endif %}"
                       href="{% url 'tickets:list' %}">
                        <i data-feather="life-buoy" class="opacity-75"></i>
                        <span>Tickets</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'documents:list' %}">
                        <i data-feather="file-text" class="opacity-75"></i>
                        <span>Documents</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'preferences:index' %}">
                        <i data-feather="settings" class="opacity-75"></i>
                        <span>Settings</span>
                    </a>
                </li>
            {% endif %}

            <li class="nav-item section-title px-2"><span class="section-pill">SUPPLIER</span></li>
            {% if request.user.role == 'SUS' %}
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'activities:list' %}">
                        <i data-feather="folder" class="opacity-75"></i>
                        <span>My Activities</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'documents:list' %}?scope=mine">
                        <i data-feather="file-text" class="opacity-75"></i>
                        <span>My Documents</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center gap-2" href="{% url 'preferences:index' %}">
                        <i data-feather="settings" class="opacity-75"></i>
                        <span>Settings</span>
                    </a>
                </li>
            {% endif %}

            <li class="nav-item mt-3">
                <a class="nav-link d-flex align-items-center gap-2" href="{% url 'notifications:inbox' %}">
                    <i data-feather="bell" class="opacity-75"></i>
                    <span>Notifications</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2" href="{% url 'accounts:profile' %}">
                    <i data-feather="user" class="opacity-75"></i>
                    <span>My Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2" href="{% url 'accounts:logout' %}">
                    <i data-feather="log-out" class="opacity-75"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>
</aside>

<style>
    /* Layout + simple “Mofi-like” sidebar */
    :root{
        --sb-bg:#273247;           /* dark bluish */
        --sb-bg-2:#1f293b;
        --sb-border:rgba(255,255,255,.06);
        --sb-text:#d6d9e0;         /* light text */
        --sb-text-dim:#9aa3b2;     /* dim text */
        --sb-accent:#7c8df8;       /* accent */
        --sb-active:#323f59;       /* active bg */
    }

    .lc-sidebar {
        position: fixed;
        top: 0; bottom: 0; left: 0;
        width: 260px;
        z-index: 1040;
        background: var(--sb-bg);
        color: var(--sb-text);
        border-right: 1px solid var(--sb-border);
    }
    .lc-sidebar-head{background:var(--sb-bg-2); border-bottom:1px solid var(--sb-border);}
    .lc-sidebar-head .navbar-brand{color:#fff}
    .lc-sidebar-head img{filter:brightness(1) saturate(1.1)}

    .page-body {
        margin-left: 260px;
        min-height: 100vh;
        background: #f7f7fb;
    }

    /* Links */
    .lc-sidebar .nav-link{
        color: var(--sb-text);
        padding:.625rem .75rem;
        border-radius:.5rem;
        font-weight:500;
    }
    .lc-sidebar .nav-link i[data-feather]{
        width:18px;height:18px; stroke:#cfd6e4; opacity:.9;
    }
    .lc-sidebar .nav-link:hover{
        background: var(--sb-active);
        color:#fff;
    }
    .lc-sidebar .nav-link.active{
        background: var(--sb-active);
        color:#fff;
        box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }

    .lc-sidebar .nav-item.section-title{margin:.75rem .5rem .25rem;}
    .lc-sidebar .section-pill{
        display:inline-block; padding:.25rem .5rem; border-radius:.5rem;
        font-size:.7rem; letter-spacing:.06em; color:#e8ebf2; background:rgba(255,255,255,.08);
    }
    .lc-sidebar .text-muted{color:var(--sb-text-dim)!important}

    .lc-sidebar .nav-item + .nav-item {
        margin-top: 2px;
    }
    .lc-sidebar .nav-item.mt-2.text-uppercase.small.text-muted {
        letter-spacing: .08em;
    }


    /* Mobile */
    @media (max-width: 767.98px) {
        .lc-sidebar {
            transform: translateX(-100%);
            transition: transform .2s ease;
            background: var(--sb-bg);
        }

        .lc-sidebar.lc-open {
            transform: translateX(0);
        }

        .page-body {
            margin-left: 0;
        }
    }

    /* Overlay visibility tied to sidebar open state */
    #lcSidebarOverlay.lc-show {
        display: block;
    }

    /* Animate desktop too */
    @media (min-width: 768px) {
        .lc-sidebar {
            transition: transform .2s ease;
        }

        body.lc-sidebar-collapsed .lc-sidebar {
            transform: translateX(-100%);
        }

        body.lc-sidebar-collapsed .page-body {
            margin-left: 0;
        }
    }
</style>
<script>
    (function () {
        const sidebar = document.getElementById('lcSidebar');
        const overlay = document.getElementById('lcSidebarOverlay');
        const closeBtn = document.getElementById('lcSidebarClose');

        if (!sidebar) return;

        const OPEN_CLASS = 'lc-open';
        const OVERLAY_SHOW = 'lc-show';
        const BODY_COLLAPSED = 'lc-sidebar-collapsed';
        const LS_KEY = 'lc:sidebar:collapsed';

        function openSidebar() {
            sidebar.classList.add(OPEN_CLASS);
            overlay && overlay.classList.add(OVERLAY_SHOW);
            document.body.classList.remove(BODY_COLLAPSED);
        }

        function closeSidebar() {
            sidebar.classList.remove(OPEN_CLASS);
            overlay && overlay.classList.remove(OVERLAY_SHOW);
        }

        function toggleSidebar() {
            if (window.matchMedia('(max-width: 767.98px)').matches) {
                // Mobile: slide in/out
                if (sidebar.classList.contains(OPEN_CLASS)) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            } else {
                // Desktop: collapse/expand layout
                const willCollapse = !document.body.classList.contains(BODY_COLLAPSED);
                document.body.classList.toggle(BODY_COLLAPSED, willCollapse);
                try {
                    localStorage.setItem(LS_KEY, willCollapse ? '1' : '');
                } catch (e) {
                }
            }
        }

        // Hook up triggers anywhere in the DOM
        document.addEventListener('click', function (e) {
            const t = e.target.closest('[data-lc-toggle="sidebar"], #lcSidebarOpen');
            if (t) {
                e.preventDefault();
                toggleSidebar();
            }
        });

        // Close actions
        overlay && overlay.addEventListener('click', closeSidebar);
        closeBtn && closeBtn.addEventListener('click', closeSidebar);

        // Escape key closes on mobile
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && sidebar.classList.contains(OPEN_CLASS)) closeSidebar();
        });

        // Apply persisted desktop state
        try {
            const saved = localStorage.getItem(LS_KEY);
            if (saved === '1') document.body.classList.add(BODY_COLLAPSED);
        } catch (e) {
        }

        // On resize, make sure overlay state is sane
        window.addEventListener('resize', function () {
            if (!window.matchMedia('(max-width: 767.98px)').matches) {
                // Leaving mobile viewport: ensure mobile overlay is hidden
                closeSidebar();
            }
        });

        if (window.feather && typeof window.feather.replace === 'function') {
            window.feather.replace({ width: 18, height: 18 });
        }
    })();
</script>